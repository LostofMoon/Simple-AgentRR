task_id: taobao_generic_search
app_id: com.taobao.taobao
task_type: type3
description: 在淘宝App中将<选择条件>的<商品描述>加入购物车

nodes:
  - id: activate_search
    # deps: [open_app_home]
    name: 激活搜索输入
    score: 10
    condition:
      type: escalate
      params:
        # action:
        #   type: action_match
        #   params:
        #     type: click
        # ui:
        #   any: ["拍照"]
        ocr:
          all: ["搜索", "猜你想搜", "历史搜索"]
        llm:
          prompt: "该步是否在激活搜索输入框？"
          expected_true: true

  - id: input_keyword
    deps: [activate_search]
    name: 输入搜索关键词
    score: 10
    condition:
      type: escalate
      params:
        # action:
        #   type: action_match
        #   params:
        #     type: input
        # ocr:
        #   any: ["取消"]
        # 在每一次llm调用中，都会将当前的task_description传入
        llm:
          prompt: "该步是否向搜索框输入了查询物品关键词？"
          expected_true: true

  - id: results_page
    deps: [input_keyword]
    name: 显示搜索结果列表
    score: 10
    condition:
      type: escalate
      params:
        # ui:
        #   any: ["拍照"]
        ocr:
          all: ["销量", "天猫", "店铺"]
        llm:
          prompt: "该步是否呈现了搜索结果列表？"
          expected_true: true

  - id: apply_filter_condition
    deps: [results_page]
    name: 按照任务要求应用筛选条件
    score: 10
    condition:
      type: escalate
      params:
        # action:
        #   type: click
        # dynamic_match:
        #   extract_from: task_description
        #   condition_patterns:
        #     price_lowest:
        #       trigger_keywords: ["价格最低", "最便宜", "价格从低到高"]
        #       verify_keywords: ["价格", "低到高", "便宜", "最低"]
        #       llm_prompt: "该步骤是否执行了按价格从低到高排序的操作？"
        #     price_highest:
        #       trigger_keywords: ["价格最高", "最贵", "价格从高到低"]
        #       verify_keywords: ["价格", "高到低", "贵", "最高"]
        #       llm_prompt: "该步骤是否执行了按价格从高到低排序的操作？"
        #     sales_highest:
        #       trigger_keywords: ["销量最高", "销量最多", "销量"]
        #       verify_keywords: ["销量", "最高", "最多"]
        #       llm_prompt: "该步骤是否执行了按销量从高到低排序的操作？"
        #     sales_lowest:
        #       trigger_keywords: ["销量最低", "销量最少"]
        #       verify_keywords: ["销量", "最低", "最少"]
        #       llm_prompt: "该步骤是否执行了按销量从低到高排序的操作？"
        #   verification_fields: ["reasoning", "text"]
          # fallback_llm: true
        # ocr:
        #   all: ["价格"]
        #   pattern: "(高|低)"
        llm:
          prompt: "该步是否按照任务task_description期望正确执行了选择筛选、排序等操作（如按价格、销量、评价、店铺等）？请结合任务task_description描述和当前操作判断。"
          # prompt: "该步是否按照任务要求执行了相应的筛选、排序等操作（如按价格排序、按销量排序、选择天猫旗舰店等）？请结合任务task_description描述和当前操作判断。"
          expected_true: true


  # - id: select_item
  #   deps: [apply_filter_condition]
  #   name: 选择某个结果项
  #   score: 15
  #   condition:
  #     type: escalate
  #     params:
  #       # action:
  #       #   type: action_match
  #       #   params:
  #       #     type: click
  #       # ocr:
  #       #   any: ["天猫", "销量"]
  #       llm:
  #         prompt: "是否点击了一个符合任务task_description要求条件的搜索结果进入详情？"
  #         expected_true: true

  - id: item_detail
    deps: [apply_filter_condition]
    name: 进入详情页
    score: 15
    condition:
      type: escalate
      params:
        ocr:
          all: ["收藏", "店铺", "客服"]
        llm:
          prompt: "是否已进入某个结果的详情页？"
          expected_true: true
          
  - id: confirm_add_to_cart
    deps: [item_detail, apply_filter_condition]
    name: 确认加入购物车
    condition:
      type: escalate
      params:
        # 仅ocr判断
        ocr:
          all: ["购物车", "购买", "加购成功"]

  - id: add_to_cart
    deps: [item_detail, apply_filter_condition]
    name: 加入购物车
    condition:
      type: escalate
      params:
        llm:
          prompt: "该步是否将任务task_description要求的物品加入购物车？"
          expected_true: true
success:
  any_of: [confirm_add_to_cart, add_to_cart]
